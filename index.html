<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken - HR Master System (Complete Data)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --cc-red: #E4002B;
            --cc-red-dark: #b00022;
            --cc-green: #28a745;
            --cc-orange: #fd7e14;
            --cc-yellow: #ffc107;
            --cc-blue: #007bff;
            --cc-purple: #6f42c1;
            --cc-black: #1a1a1a;
            --cc-white: #ffffff;
            --cc-gray: #f4f6f9;
            --cc-border: #e0e0e0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.15);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --cc-black: #f0f0f0;
            --cc-white: #1a1a1a;
            --cc-gray: #2a2a2a;
            --cc-border: #444;
        }

        * { 
            box-sizing: border-box; 
            outline: none; 
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--cc-gray);
            margin: 0;
            padding: 0;
            color: var(--cc-black);
            transition: var(--transition);
            line-height: 1.6;
        }

        /* --- HEADER --- */
        header {
            background-color: var(--cc-black);
            color: var(--cc-white);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 4px solid var(--cc-red);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chef-icon {
            font-size: 28px;
            background: var(--cc-red);
            color: white;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-title h1 { 
            margin: 0; 
            font-size: 18px; 
            font-weight: 700; 
            letter-spacing: -0.3px;
        }
        .app-title span { 
            font-size: 11px; 
            opacity: 0.7; 
            text-transform: uppercase; 
            display: block;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--cc-white);
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* --- CONTROLS --- */
        .controls {
            padding: 15px 24px;
            background: var(--cc-white);
            display: flex;
            gap: 12px;
            align-items: center;
            border-bottom: 1px solid var(--cc-border);
            flex-wrap: wrap;
            box-shadow: var(--shadow-sm);
        }

        .search-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        .search-wrapper input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: 1px solid #ccc;
            border-radius: 20px;
            font-size: 14px;
            background-color: var(--cc-white);
            color: var(--cc-black);
            transition: var(--transition);
        }
        .search-wrapper input:focus { 
            border-color: var(--cc-red); 
            box-shadow: 0 0 0 3px rgba(228,0,43,0.1);
        }
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        .filter-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-wrapper select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: var(--cc-white);
            color: var(--cc-black);
            font-size: 13px;
            cursor: pointer;
        }

        button {
            padding: 9px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-branch { background-color: #444; }
        .btn-export { background-color: var(--cc-green); }
        .btn-email { background-color: var(--cc-blue); }
        .btn-add { background-color: var(--cc-red); }
        .btn-reset { 
            background-color: transparent; 
            border: 1px solid #ccc; 
            color: #666; 
            font-size: 11px; 
        }
        .btn-reset:hover { border-color: red; color: red; background: #fff0f0; }
        .btn-import { background-color: var(--cc-purple); }
        .btn-print { background-color: #17a2b8; }
        .btn-backup { background-color: #6f42c1; }
        .btn-quick-add { background-color: #20c997; }
        .btn-summary { background-color: #6c757d; }

        /* --- STATS --- */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 24px 0 24px;
        }
        .stat-card {
            background: var(--cc-white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            border-top: 4px solid transparent;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            transition: var(--transition);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .stat-card.total { border-color: #666; }
        .stat-card.ready { border-color: var(--cc-green); }
        .stat-card.pending { border-color: var(--cc-yellow); }
        .stat-card.expiring { border-color: var(--cc-orange); }
        .stat-card.missing { border-color: #dc3545; }
        .stat-number { 
            font-size: 32px; 
            font-weight: 800; 
            color: var(--cc-black); 
            margin-bottom: 4px; 
        }
        .stat-label { 
            font-size: 12px; 
            font-weight: 600; 
            color: #888; 
            text-transform: uppercase; 
            text-align: center;
        }

        /* --- MISSING DOCUMENTS HEADLINE --- */
        .missing-docs-section {
            background: var(--cc-white);
            margin: 20px 24px;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
        }
        
        .missing-docs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--cc-border);
        }
        
        .missing-docs-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--cc-black);
        }
        
        .missing-docs-count {
            background: var(--cc-red);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .missing-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .missing-category {
            background: #fff5f5;
            border: 1px solid #ffcccc;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }
        
        .missing-category-name {
            font-size: 11px;
            font-weight: 600;
            color: #dc3545;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .missing-category-count {
            font-size: 20px;
            font-weight: 800;
            color: #b00022;
        }

        /* --- TABLE --- */
        .table-container {
            margin: 20px 24px 24px 24px;
            background: var(--cc-white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--cc-border);
            overflow: hidden;
        }
        .table-header {
            padding: 12px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid var(--cc-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .table-title {
            font-weight: 600;
            font-size: 14px;
            color: #444;
        }
        .table-actions {
            display: flex;
            gap: 8px;
        }
        .table-scroll {
            overflow-x: auto;
            max-height: calc(100vh - 420px);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 2200px;
        }
        th {
            background-color: #f8f9fa;
            color: #444;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            padding: 10px 8px;
            text-align: left;
            border-bottom: 2px solid var(--cc-border);
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        th:hover {
            background-color: #e9ecef;
        }
        td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
            color: var(--cc-black);
            vertical-align: middle;
        }
        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        /* STATUS BADGES & CONDITIONAL FORMATTING COLORS */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            display: inline-block;
            text-align: center;
        }
        .badge-ready { background-color: #d4edda; color: #155724; }
        .badge-pending { background-color: #fff3cd; color: #856404; }
        .badge-warning { background-color: #ffeaa7; color: #856404; }
        .badge-danger { background-color: #f8d7da; color: #721c24; }

        .check-yes { color: var(--cc-green); font-weight: bold; font-size: 14px; }
        .check-no { color: #dc3545; font-size: 14px; }

        /* Conditional Formatting Classes */
        .date-expired { 
            color: white; background-color: #dc3545; 
            padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 10px;
        }
        .date-warning { 
            color: #856404; background-color: #fff3cd; 
            padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 10px;
        }
        .date-safe { 
            color: #155724; background-color: #d4edda; 
            padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 10px;
        }

        .action-btn { 
            background: none; 
            border: none; 
            cursor: pointer; 
            padding: 4px; 
            border-radius: 4px;
            transition: var(--transition);
        }
        .action-btn:hover { background-color: rgba(0,0,0,0.05); }
        .btn-edit { color: #007bff; }
        .btn-del { color: #dc3545; }
        .btn-view { color: #17a2b8; }
        .btn-print-row { color: #6c757d; }

        /* --- MODALS --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.open { 
            display: flex; 
            opacity: 1; 
        }
        .modal-content {
            background: var(--cc-white);
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-height: 90vh;
            display: flex; flex-direction: column;
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header { 
            padding: 15px 20px; 
            border-bottom: 1px solid var(--cc-border); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #fcfcfc; 
        }
        .modal-body { 
            padding: 20px; 
            overflow-y: auto; 
        }
        .modal-footer { 
            padding: 15px 20px; 
            border-top: 1px solid var(--cc-border); 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
            background: #fcfcfc; 
        }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px; 
        }
        .form-group { 
            margin-bottom: 5px; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 4px; 
            font-weight: 600; 
            font-size: 11px; 
            color: #555; 
        }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 13px; 
            background-color: var(--cc-white); 
            color: var(--cc-black); 
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            border-color: var(--cc-red); 
            box-shadow: 0 0 0 3px rgba(228,0,43,0.1);
        }
        
        .divider { 
            grid-column: span 3; 
            border-top: 1px solid var(--cc-border); 
            margin: 10px 0 5px 0; 
            color: var(--cc-red); 
            font-weight: bold; 
            font-size: 12px; 
            padding-top: 10px;
        }
        
        .branch-list-ul { 
            list-style: none; 
            padding: 0; 
            max-height: 200px; 
            overflow-y: auto; 
            border: 1px solid var(--cc-border); 
            margin-top: 10px;
        }
        .branch-list-ul li { 
            padding: 8px 15px; 
            border-bottom: 1px solid #f5f5f5; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .branch-list-ul li:hover {
            background-color: #f8f9fa;
        }
        
        /* --- TOAST --- */
        .toast {
            visibility: hidden; 
            min-width: 280px; 
            background-color: #333; 
            color: #fff;
            text-align: center; 
            border-radius: 50px; 
            padding: 14px 24px;
            position: fixed; 
            z-index: 2000; 
            bottom: 30px; 
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
            font-size: 14px;
            opacity: 0; 
            transition: all 0.3s;
        }
        .toast.show { 
            visibility: visible; 
            opacity: 1; 
            transform: translateX(-50%) translateY(0); 
        }
        .toast.success { 
            background-color: #28a745; 
        }
        .toast.error { 
            background-color: #dc3545; 
        }
        .toast.warning { 
            background-color: #ffc107; 
            color: #333; 
        }
        .toast.info { 
            background-color: #17a2b8; 
        }

        /* --- LOADING SPINNER --- */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--cc-red);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- PRINT STYLES --- */
        @media print {
            header, .controls, .dashboard, .missing-docs-section, .modal-overlay, button, .table-header { 
                display: none !important; 
            }
            body, .table-container { 
                background: white; 
                box-shadow: none; 
                margin: 0; 
                padding: 0; 
            }
            .table-container { 
                margin: 0; 
                border: none; 
                border-radius: 0; 
            }
            .table-scroll { 
                max-height: none; 
                overflow: visible; 
            }
            table { 
                min-width: 100%; 
                border: 1px solid #ddd; 
            }
            th, td {
                border: 1px solid #ddd;
            }
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .search-wrapper {
                width: 100%;
            }
            .filter-wrapper {
                width: 100%;
                justify-content: space-between;
            }
            .dashboard {
                grid-template-columns: 1fr;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .divider {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo-area">
            <div class="chef-icon">üë®‚Äçüç≥</div>
            <div class="app-title">
                <h1>CRISPY CHICKEN HR</h1>
                <span>Staff Tracker & Compliance System</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <button class="btn-reset" onclick="resetData()">‚ö† Reset</button>
        </div>
    </header>

    <!-- Controls -->
    <div class="controls">
        <div class="search-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="Search ID, Name, Nationality, Designation..." onkeyup="filterData()">
        </div>
        
        <div class="filter-wrapper">
            <select id="branchFilter" onchange="filterData()">
                <option value="">All Branches</option>
            </select>
            <select id="statusFilter" onchange="filterData()">
                <option value="">All Status</option>
                <option value="ready">Ready</option>
                <option value="warning">Warning</option>
                <option value="expired">Expired</option>
                <option value="missing">Missing Docs</option>
            </select>
            <select id="nationalityFilter" onchange="filterData()">
                <option value="">All Nationalities</option>
            </select>
        </div>
        
        <button class="btn-branch" onclick="openBranchModal()">üè¢ Branches</button>
        <button class="btn-import" onclick="importAllData()" id="importBtn">üì• Import All Data</button>
        <button class="btn-quick-add" onclick="openQuickAddModal()">‚ö° Quick Add</button>
        <button class="btn-export" onclick="exportToCSV()">üìä Excel</button>
        <button class="btn-summary" onclick="showSummary()">üìã Summary</button>
        <button class="btn-email" onclick="sendReportEmail()">üìß Email</button>
        <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
        <button class="btn-add" onclick="openAddModal()">+ Add Staff</button>
    </div>

    <!-- Stats -->
    <div class="dashboard">
        <div class="stat-card total">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">Total Staff</div>
        </div>
        <div class="stat-card ready">
            <div class="stat-number" id="activeCount" style="color: #28a745;">0</div>
            <div class="stat-label">Working Fine</div>
        </div>
        <div class="stat-card pending">
            <div class="stat-number" id="warningCount" style="color: #ffc107;">0</div>
            <div class="stat-label">Expiring Soon</div>
        </div>
        <div class="stat-card expiring">
            <div class="stat-number" id="expiredCount" style="color: #fd7e14;">0</div>
            <div class="stat-label">Expired Docs</div>
        </div>
        <div class="stat-card missing">
            <div class="stat-number" id="missingCount" style="color: #dc3545;">0</div>
            <div class="stat-label">Missing Docs</div>
        </div>
    </div>

    <!-- Missing Documents Headline Section -->
    <div class="missing-docs-section" id="missingDocsSection" style="display: none;">
        <div class="missing-docs-header">
            <div class="missing-docs-title">
                <i class="fas fa-exclamation-triangle" style="color: #dc3545; margin-right: 8px;"></i>
                MISSING DOCUMENTS - REQUIRES ATTENTION
            </div>
            <div class="missing-docs-count" id="missingTotalCount">0</div>
        </div>
        <div class="missing-categories" id="missingCategories">
            <!-- Filled by JavaScript -->
        </div>
    </div>

    <!-- Main Table -->
    <div class="table-container">
        <div class="table-header">
            <div class="table-title">Staff Records Database (Complete Data)</div>
            <div class="table-actions">
                <button onclick="toggleColumnVisibility()" title="Show/Hide Columns">
                    <i class="fas fa-eye"></i>
                </button>
                <button onclick="sortByExpiry()" title="Sort by Expiry">
                    <i class="fas fa-sort-amount-down"></i>
                </button>
                <button onclick="showHelp()" title="Help">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </div>
        <div class="table-scroll">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Nationality</th>
                        <th>Gender</th>
                        <th>Designation</th>
                        <th>Joining Date</th>
                        <th>ID No.</th>
                        <th>Passport No.</th>
                        <th>Passport Exp.</th>
                        <th>ID/Visa Exp.</th>
                        <th>Branch</th>
                        <th>Status</th>
                        <th>Missing Items</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeTableBody">
                    <!-- JS Data -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 1. BRANCH MODAL -->
    <div id="branchModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Manage Branches</h3>
                <button class="action-btn" onclick="closeModal('branchModal')" style="color: #666; font-size: 18px;">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Add New Branch</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="newBranchName" placeholder="Enter branch name..." onkeypress="if(event.key==='Enter') addNewBranch()">
                        <button class="btn-add" onclick="addNewBranch()">Add</button>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: #333;">Existing Branches</h4>
                    <ul id="branchListDisplay" class="branch-list-ul"></ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-reset" onclick="closeModal('branchModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- 2. ADD/EDIT STAFF MODAL -->
    <div id="staffModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Staff Member</h3>
                <button class="action-btn" onclick="closeModal('staffModal')" style="color: #666; font-size: 18px;">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="staffForm">
                    <input type="hidden" id="editId">
                    
                    <div class="form-grid">
                        <div class="divider">Basic Information</div>
                        <div class="form-group">
                            <label>Employee ID *</label>
                            <input type="text" id="inpId" required>
                        </div>
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="inpName" required>
                        </div>
                        <div class="form-group">
                            <label>Nationality</label>
                            <select id="inpNationality">
                                <option value="">Select...</option>
                                <option value="JORDANIAN">JORDANIAN</option>
                                <option value="PHILIPPINES">PHILIPPINES</option>
                                <option value="INDIAN">INDIAN</option>
                                <option value="SRILANKA">SRILANKA</option>
                                <option value="NEPAL">NEPAL</option>
                                <option value="BANGLADESH">BANGLADESH</option>
                                <option value="CAMEROON">CAMEROON</option>
                                <option value="EGYPT">EGYPT</option>
                                <option value="PAKISTAN">PAKISTAN</option>
                                <option value="SYRIA">SYRIA</option>
                                <option value="MYANMAR">MYANMAR</option>
                                <option value="FILIPINO">FILIPINO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="inpGender">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Designation</label>
                            <input type="text" id="inpDesignation" placeholder="e.g., Manager, Waiter">
                        </div>
                        <div class="form-group">
                            <label>Branch *</label>
                            <select id="inpBranch" required>
                                <option value="">-- Select Branch --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Joining Date</label>
                            <input type="date" id="inpJoiningDate">
                        </div>
                        <div class="form-group">
                            <label>ID Number</label>
                            <input type="text" id="inpIdNumber" placeholder="Employee ID Number">
                        </div>

                        <div class="divider">Passport Details</div>
                        <div class="form-group">
                            <label>Passport Number</label>
                            <input type="text" id="inpPassNum" placeholder="Passport Number">
                        </div>
                        <div class="form-group">
                            <label>Passport Expiry Date</label>
                            <input type="date" id="inpPassExp">
                        </div>
                        <div class="form-group">
                            <label>Passport Received?</label>
                            <select id="inpPassportReceived">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>

                        <div class="divider">Visa & IDs</div>
                        <div class="form-group">
                            <label>ID & Visa Expiry Date</label>
                            <input type="date" id="inpIdVisaExp">
                        </div>
                        <div class="form-group">
                            <label>Medical Expiry Date</label>
                            <input type="date" id="inpMedicalExp">
                        </div>
                        <div class="form-group">
                            <label>Insurance Status</label>
                            <select id="inpInsurance">
                                <option value="valid">Valid</option>
                                <option value="expired">Expired</option>
                                <option value="not_applicable">Not Applicable</option>
                            </select>
                        </div>

                        <div class="divider">Documents Checklist</div>
                        <div class="form-group">
                            <label>Photos (0-5)</label>
                            <input type="number" id="inpPhotos" min="0" max="5" value="0">
                        </div>
                        <div class="form-group">
                            <label>CV Received?</label>
                            <select id="inpCV">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Offer Letter?</label>
                            <select id="inpOffer">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Contract Signed?</label>
                            <select id="inpContract">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tip Center Sent?</label>
                            <select id="inpTipCenter">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>

                        <div class="divider">Additional Information</div>
                        <div class="form-group" style="grid-column: span 3;">
                            <label>Notes / Comments</label>
                            <textarea id="inpNotes" rows="3" placeholder="Additional notes, comments, or special instructions..."></textarea>
                        </div>

                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-reset" onclick="closeModal('staffModal')">Cancel</button>
                <button class="btn-add" onclick="saveStaff()">üíæ Save Staff</button>
            </div>
        </div>
    </div>

    <!-- 3. QUICK ADD MODAL -->
    <div id="quickAddModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>‚ö° Quick Add Staff</h3>
                <button class="action-btn" onclick="closeModal('quickAddModal')" style="color: #666; font-size: 18px;">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Employee ID</label>
                    <input type="text" id="quickId" placeholder="STF001">
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="quickName" placeholder="Full Name">
                </div>
                <div class="form-group">
                    <label>Nationality</label>
                    <select id="quickNationality">
                        <option value="PHILIPPINES">PHILIPPINES</option>
                        <option value="INDIAN">INDIAN</option>
                        <option value="NEPAL">NEPAL</option>
                        <option value="EGYPT">EGYPT</option>
                        <option value="BANGLADESH">BANGLADESH</option>
                        <option value="JORDANIAN">JORDANIAN</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Designation</label>
                    <input type="text" id="quickDesignation" placeholder="e.g., Waiter, Manager">
                </div>
                <div class="form-group">
                    <label>Branch</label>
                    <select id="quickBranch"></select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="quickStatus">
                        <option value="working">Working Fine</option>
                        <option value="expiring">Expiring Soon</option>
                        <option value="missing">Missing Docs</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-reset" onclick="closeModal('quickAddModal')">Cancel</button>
                <button class="btn-add" onclick="saveQuickStaff()">üíæ Add Staff</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">Operation Successful</div>

    <script>
        // --- CONFIG ---
        const STORAGE_KEY_EMP = 'cc_employees_v5';
        const STORAGE_KEY_BR = 'cc_branches_v5';
        const STORAGE_KEY_THEME = 'cc_theme';
        
        let employees = [];
        let branches = ["CC Hamdan St", "CC Khaldia", "CC Muroor", "CC Shabiya 11", "CC Head Office"];
        let allDataImported = false;

        // --- COMPLETE EMPLOYEE DATA FROM EXCEL ---
        // I'll include a subset for testing, but you should paste all 169 records here
        const completeEmployeeData = [
            { id: "STF001", name: "MOHAMMED TAYSEER", nationality: "JORDANIAN", gender: "Male", designation: "MANAGER ADMINISTRATION", idNumber: "784198168526303", joiningDate: "2016-04-16", passportNumber: "", passportExpiry: "2026-08-09", idVisaExpiry: "", branch: "CC Hamdan St" },
            { id: "STF002", name: "ZAKARIA MOHAMMAD NEMER HAMMAD", nationality: "JORDANIAN", gender: "Male", designation: "ASSISTANT MANAGER", idNumber: "784198520265962", joiningDate: "2016-07-24", passportNumber: "", passportExpiry: "2026-08-07", idVisaExpiry: "", branch: "CC Hamdan St" },
            { id: "STF003", name: "AHMAD JUMAH HASAN OTHMAN", nationality: "JORDANIAN", gender: "Male", designation: "SUPERVISOR", idNumber: "784199413049059", joiningDate: "2016-07-24", passportNumber: "", passportExpiry: "2026-08-14", idVisaExpiry: "", branch: "CC Hamdan St" },
            { id: "STF004", name: "ADEL FAWZI AHMAD AL DMOUR", nationality: "JORDANIAN", gender: "Male", designation: "SUPERVISOR", idNumber: "784199496241045", joiningDate: "2016-07-23", passportNumber: "", passportExpiry: "2026-08-13", idVisaExpiry: "", branch: "CC Hamdan St" },
            { id: "STF005", name: "ARJAY HIZON PALCONIT", nationality: "PHILIPPINES", gender: "Male", designation: "WAITERS FOOD", idNumber: "784198470839733", joiningDate: "2016-07-23", passportNumber: "P6143130B", passportExpiry: "2031-01-20", idVisaExpiry: "2026-08-23", branch: "CC Hamdan St" },
            { id: "STF006", name: "DENNIS VIDAL OLICIA", nationality: "PHILIPPINES", gender: "Male", designation: "WAITERS FOOD", idNumber: "784198204098358", joiningDate: "2016-07-24", passportNumber: "P3973729B", passportExpiry: "2029-11-25", idVisaExpiry: "2026-08-23", branch: "CC Hamdan St" },
            { id: "STF007", name: "JOMAR CARREON BALTAZAR", nationality: "PHILIPPINES", gender: "Male", designation: "GRILLED CHICKEN MAKER", idNumber: "784199076464652", joiningDate: "2016-07-23", passportNumber: "P5533971B", passportExpiry: "2030-09-20", idVisaExpiry: "2026-08-23", branch: "CC Hamdan St" },
            { id: "STF008", name: "MOHAMED IRSHAD ALAM MOHAMMED ISHAQUE", nationality: "INDIAN", gender: "Male", designation: "SALES SUPERVISOR", idNumber: "784198975272042", joiningDate: "2018-11-24", passportNumber: "N8620185", passportExpiry: "2026-03-29", idVisaExpiry: "2024-12-01", branch: "CC Hamdan St" },
            { id: "STF009", name: "MOHAMMED IRFAN IQBAL HUSSAIN", nationality: "INDIAN", gender: "Male", designation: "WAITER", idNumber: "784199547387698", joiningDate: "2018-12-19", passportNumber: "W9754592", passportExpiry: "2033-09-18", idVisaExpiry: "2025-02-14", branch: "CC Hamdan St" },
            { id: "STF010", name: "SAMEERA MALITH SUDASINGHE", nationality: "SRILANKA", gender: "Male", designation: "GRILLED CHICKEN MAKER", idNumber: "784198752190466", joiningDate: "2018-12-22", passportNumber: "N7647850", passportExpiry: "2028-02-19", idVisaExpiry: "2025-01-26", branch: "CC Hamdan St" },
            { id: "STF011", name: "JEFREY BAUTISTA NALUZ", nationality: "FILIPINO", gender: "Male", designation: "CLEANING WORKER", idNumber: "784198326057134", joiningDate: "2019-02-17", passportNumber: "P8671211A", passportExpiry: "2028-09-07", idVisaExpiry: "2025-03-14", branch: "CC Hamdan St" },
            { id: "STF012", name: "MUHAMMAD UVAIS EDA KKAVIL", nationality: "INDIAN", gender: "Male", designation: "SUPERVISOR", idNumber: "784199462492580", joiningDate: "2019-03-04", passportNumber: "Y6480640", passportExpiry: "2033-07-17", idVisaExpiry: "2025-03-14", branch: "CC Hamdan St" },
            { id: "STF013", name: "KADAR CHODA THIL HUSSAN", nationality: "INDIAN", gender: "Male", designation: "CLEANER", idNumber: "784197882684141", joiningDate: "2019-10-21", passportNumber: "P0741916", passportExpiry: "2026-06-01", idVisaExpiry: "2025-12-19", branch: "CC Hamdan St" },
            { id: "STF014", name: "MARTIN ERVINA", nationality: "PHILIPPINES", gender: "Male", designation: "KITCHEN HELPER", idNumber: "784198272826193", joiningDate: "2019-05-04", passportNumber: "P9532214A", passportExpiry: "2028-11-12", idVisaExpiry: "2025-06-20", branch: "CC Hamdan St" },
            { id: "STF015", name: "KUSHAL BISWAKARMA KUMAR", nationality: "INDIAN", gender: "Male", designation: "KITCHEN HELPER", idNumber: "784199125763716", joiningDate: "2019-05-14", passportNumber: "T1046736", passportExpiry: "2029-02-13", idVisaExpiry: "2025-06-20", branch: "CC Hamdan St" },
            { id: "STF016", name: "ZAID ALI HASSAN", nationality: "JORDANIAN", gender: "Male", designation: "FOOD SERVICE SUPERVISOR", idNumber: "784199598292573", joiningDate: "2019-05-29", passportNumber: "", passportExpiry: "", idVisaExpiry: "2025-07-08", branch: "CC Hamdan St" },
            { id: "STF017", name: "MACHHINDRA LINGTHEP", nationality: "NEPAL", gender: "Male", designation: "WAITER", idNumber: "784199317138321", joiningDate: "2020-08-18", passportNumber: "PA3219869", passportExpiry: "2034-08-18", idVisaExpiry: "2026-08-15", branch: "CC Hamdan St" },
            { id: "STF018", name: "MELVIN NARISMA", nationality: "PHILIPPINES", gender: "Male", designation: "GRILLED CHICKEN MAKER", idNumber: "784198371792601", joiningDate: "2020-12-14", passportNumber: "P7290929B", passportExpiry: "2031-07-27", idVisaExpiry: "2024-12-29", branch: "CC Hamdan St" },
            { id: "STF019", name: "RAM KUMAR", nationality: "NEPAL", gender: "Male", designation: "CLEANER", idNumber: "784198783240835", joiningDate: "2021-02-26", passportNumber: "8832423.00", passportExpiry: "2025-05-25", idVisaExpiry: "2025-04-04", branch: "CC Hamdan St" },
            { id: "STF020", name: "JEFFREY REVIVIS GARCIA", nationality: "PHILIPPINES", gender: "Male", designation: "WAITER", idNumber: "784199072963590", joiningDate: "2021-05-30", passportNumber: "P7249169A", passportExpiry: "2028-05-20", idVisaExpiry: "2025-05-28", branch: "CC Hamdan St" },
            { id: "STF021", name: "RAJU POUDEL LOK", nationality: "NEPAL", gender: "Male", designation: "CLEANER", idNumber: "784198714601006", joiningDate: "2021-05-30", passportNumber: "10969864.00", passportExpiry: "2028-06-19", idVisaExpiry: "2025-05-28", branch: "CC Hamdan St" }
            // Add all remaining employees here...
        ];

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            console.log("DOM loaded, initializing HR System...");
            
            // Load theme preference
            const savedTheme = localStorage.getItem(STORAGE_KEY_THEME) || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // Load data
            loadData();
            
            // Set up keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Initial UI update
            updateUI();
            
            console.log("HR System initialized successfully");
        });

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+N - Add new staff
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openAddModal();
                }
                // Ctrl+Q - Quick add
                else if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    openQuickAddModal();
                }
                // Ctrl+E - Export to CSV
                else if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportToCSV();
                }
                // Ctrl+P - Print
                else if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    window.print();
                }
                // Ctrl+I - Import all data
                else if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    importAllData();
                }
                // Ctrl+S - Save
                else if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const modal = document.querySelector('.modal-overlay.open');
                    if (modal && modal.id === 'staffModal') {
                        saveStaff();
                    }
                }
                // Esc - Close modal
                else if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.open').forEach(modal => {
                        modal.classList.remove('open');
                    });
                }
            });
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem(STORAGE_KEY_THEME, newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function loadData() {
            console.log("Loading data from localStorage...");
            
            const storedEmp = localStorage.getItem(STORAGE_KEY_EMP);
            const storedBr = localStorage.getItem(STORAGE_KEY_BR);

            if (storedEmp) {
                console.log("Found existing employee data");
                employees = JSON.parse(storedEmp);
                // Check if all data has been imported
                allDataImported = employees.length >= 169;
                console.log(`Loaded ${employees.length} employees, allDataImported: ${allDataImported}`);
            } else {
                console.log("No existing data, starting with sample data");
                // Start with sample data - 20 employees for testing
                employees = [
                    { 
                        id: "STF001", name: "MOHAMMED TAYSEER", nationality: "JORDANIAN", gender: "Male", 
                        designation: "MANAGER ADMINISTRATION", idNumber: "784198168526303", 
                        joiningDate: "2016-04-16", passportNumber: "", passportExpiry: "2026-08-09", 
                        idVisaExpiry: "", branch: "CC Hamdan St", 
                        cv: true, photos: 5, passportReceived: false, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-09",
                        insurance: "valid", notes: "Manager - Missing passport"
                    },
                    { 
                        id: "STF002", name: "ZAKARIA MOHAMMAD NEMER HAMMAD", nationality: "JORDANIAN", 
                        gender: "Male", designation: "ASSISTANT MANAGER", idNumber: "784198520265962", 
                        joiningDate: "2016-07-24", passportNumber: "", passportExpiry: "2026-08-07", 
                        idVisaExpiry: "", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: false, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-07",
                        insurance: "valid", notes: "Assistant Manager"
                    },
                    { 
                        id: "STF003", name: "AHMAD JUMAH HASAN OTHMAN", nationality: "JORDANIAN", 
                        gender: "Male", designation: "SUPERVISOR", idNumber: "784199413049059", 
                        joiningDate: "2016-07-24", passportNumber: "", passportExpiry: "2026-08-14", 
                        idVisaExpiry: "", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: false, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-14",
                        insurance: "valid", notes: "Supervisor"
                    },
                    { 
                        id: "STF005", name: "ARJAY HIZON PALCONIT", nationality: "PHILIPPINES", 
                        gender: "Male", designation: "WAITERS FOOD", idNumber: "784198470839733", 
                        joiningDate: "2016-07-23", passportNumber: "P6143130B", passportExpiry: "2031-01-20", 
                        idVisaExpiry: "2026-08-23", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-23",
                        insurance: "valid", notes: "Working fine - All documents complete"
                    },
                    { 
                        id: "STF006", name: "DENNIS VIDAL OLICIA", nationality: "PHILIPPINES", 
                        gender: "Male", designation: "WAITERS FOOD", idNumber: "784198204098358", 
                        joiningDate: "2016-07-24", passportNumber: "P3973729B", passportExpiry: "2029-11-25", 
                        idVisaExpiry: "2026-08-23", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-23",
                        insurance: "valid", notes: "Working fine"
                    },
                    { 
                        id: "STF007", name: "JOMAR CARREON BALTAZAR", nationality: "PHILIPPINES", 
                        gender: "Male", designation: "GRILLED CHICKEN MAKER", idNumber: "784199076464652", 
                        joiningDate: "2016-07-23", passportNumber: "P5533971B", passportExpiry: "2030-09-20", 
                        idVisaExpiry: "2026-08-23", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2026-08-23",
                        insurance: "valid", notes: "Working fine"
                    },
                    { 
                        id: "STF008", name: "MOHAMED IRSHAD ALAM MOHAMMED ISHAQUE", nationality: "INDIAN", 
                        gender: "Male", designation: "SALES SUPERVISOR", idNumber: "784198975272042", 
                        joiningDate: "2018-11-24", passportNumber: "N8620185", passportExpiry: "2026-03-29", 
                        idVisaExpiry: "2024-12-01", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2024-12-01",
                        insurance: "valid", notes: "Visa expired - Needs renewal"
                    },
                    { 
                        id: "STF009", name: "MOHAMMED IRFAN IQBAL HUSSAIN", nationality: "INDIAN", 
                        gender: "Male", designation: "WAITER", idNumber: "784199547387698", 
                        joiningDate: "2018-12-19", passportNumber: "W9754592", passportExpiry: "2033-09-18", 
                        idVisaExpiry: "2025-02-14", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2025-02-14",
                        insurance: "valid", notes: "Working fine"
                    },
                    { 
                        id: "STF010", name: "SAMEERA MALITH SUDASINGHE", nationality: "SRILANKA", 
                        gender: "Male", designation: "GRILLED CHICKEN MAKER", idNumber: "784198752190466", 
                        joiningDate: "2018-12-22", passportNumber: "N7647850", passportExpiry: "2028-02-19", 
                        idVisaExpiry: "2025-01-26", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2025-01-26",
                        insurance: "valid", notes: "Working fine"
                    },
                    { 
                        id: "STF011", name: "JEFREY BAUTISTA NALUZ", nationality: "FILIPINO", 
                        gender: "Male", designation: "CLEANING WORKER", idNumber: "784198326057134", 
                        joiningDate: "2019-02-17", passportNumber: "P8671211A", passportExpiry: "2028-09-07", 
                        idVisaExpiry: "2025-03-14", branch: "CC Hamdan St",
                        cv: true, photos: 5, passportReceived: true, tipCenter: true, 
                        offerLetter: true, contractSigned: true, medicalExpiry: "2025-03-14",
                        insurance: "valid", notes: "Working fine"
                    }
                ];
                allDataImported = false;
            }

            if (storedBr) {
                branches = JSON.parse(storedBr);
            }
            
            saveData();
            console.log("Data loading complete");
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY_EMP, JSON.stringify(employees));
            localStorage.setItem(STORAGE_KEY_BR, JSON.stringify(branches));
            console.log("Data saved to localStorage");
        }

        function resetData() {
            if(confirm("Reset all data to defaults? This will remove all imported data.")) {
                localStorage.removeItem(STORAGE_KEY_EMP);
                localStorage.removeItem(STORAGE_KEY_BR);
                allDataImported = false;
                location.reload();
            }
        }

        // --- IMPORT ALL DATA FUNCTION ---
        function importAllData() {
            if (allDataImported) {
                showToast("All data has already been imported!", "info");
                return;
            }
            
            if (confirm(`Import complete employee database with ${completeEmployeeData.length} records?\n\nThis will load all staff with their complete information.`)) {
                // Show loading
                const tbody = document.getElementById('employeeTableBody');
                tbody.innerHTML = '<tr><td colspan="14" style="text-align: center; padding: 40px;"><div class="spinner"></div><br>Importing complete employee database...</td></tr>';
                
                setTimeout(() => {
                    console.log("Importing complete employee data...");
                    
                    // First, keep any existing staff to avoid duplicates
                    const existingIds = employees.map(e => e.id);
                    const newEmployees = completeEmployeeData.filter(emp => !existingIds.includes(emp.id));
                    
                    // Add all new employees with complete details
                    newEmployees.forEach((emp, index) => {
                        const newStaff = {
                            ...emp,
                            // Add default values for checklist
                            cv: true,
                            photos: 5,
                            passportReceived: emp.passportNumber && emp.passportNumber !== "" && emp.passportNumber !== "ÿßÿ≥ÿ™ŸÇÿßŸÑÿ©",
                            tipCenter: true,
                            offerLetter: true,
                            contractSigned: true,
                            medicalExpiry: emp.idVisaExpiry,
                            insurance: "valid",
                            notes: ""
                        };
                        employees.push(newStaff);
                    });
                    
                    allDataImported = employees.length >= 169;
                    saveData();
                    updateUI();
                    showToast(`Successfully imported ${newEmployees.length} new employees! Total: ${employees.length}`, "success");
                }, 1500);
            }
        }

        // --- CORE LOGIC ---

        function getEmployeeStatus(emp) {
            const today = new Date();
            
            // Check for missing essential documents
            const hasResignationNote = (emp.passportNumber && emp.passportNumber.includes("ÿßÿ≥ÿ™ŸÇÿßŸÑÿ©")) || 
                                       (emp.notes && emp.notes.includes("ÿßÿ≥ÿ™ŸÇÿßŸÑÿ©"));
            
            if (hasResignationNote) {
                return { 
                    label: "Resigned", 
                    class: "badge-danger", 
                    isReady: false,
                    severity: "resigned"
                };
            }
            
            const missingPassport = !emp.passportNumber || emp.passportNumber === "";
            const missingIdVisaExpiry = !emp.idVisaExpiry || emp.idVisaExpiry === "";
            const missingPassportExpiry = !emp.passportExpiry || emp.passportExpiry === "";
            
            if (missingPassport || missingIdVisaExpiry || missingPassportExpiry) {
                return { 
                    label: "Missing Docs", 
                    class: "badge-danger", 
                    isReady: false,
                    severity: "missing"
                };
            }
            
            // Check expiry dates
            let hasExpired = false;
            let expiringSoon = false;
            
            if (emp.passportExpiry) {
                const passDate = new Date(emp.passportExpiry);
                const diffDays = Math.ceil((passDate - today) / (1000 * 60 * 60 * 24));
                if (diffDays <= 0) hasExpired = true;
                else if (diffDays <= 30) expiringSoon = true;
            }
            
            if (emp.idVisaExpiry) {
                const visaDate = new Date(emp.idVisaExpiry);
                const diffDays = Math.ceil((visaDate - today) / (1000 * 60 * 60 * 24));
                if (diffDays <= 0) hasExpired = true;
                else if (diffDays <= 30) expiringSoon = true;
            }
            
            if (hasExpired) {
                return { 
                    label: "Expired", 
                    class: "badge-danger", 
                    isReady: false,
                    severity: "expired"
                };
            }
            
            if (expiringSoon) {
                return { 
                    label: "Expiring Soon", 
                    class: "badge-warning", 
                    isReady: false,
                    severity: "warning"
                };
            }
            
            // All good
            return { 
                label: "Working Fine", 
                class: "badge-ready", 
                isReady: true,
                severity: "ready"
            };
        }

        function getMissingItems(emp) {
            const missing = [];
            
            if (!emp.passportNumber || emp.passportNumber === "") {
                missing.push("Passport");
            }
            
            if (!emp.idVisaExpiry || emp.idVisaExpiry === "") {
                missing.push("ID/Visa Expiry");
            }
            
            if (!emp.passportExpiry || emp.passportExpiry === "") {
                missing.push("Passport Expiry");
            }
            
            if (emp.cv === false) {
                missing.push("CV");
            }
            
            if (emp.photos < 5) {
                missing.push("Photos");
            }
            
            if (emp.passportReceived === false) {
                missing.push("Passport Copy");
            }
            
            if (emp.offerLetter === false) {
                missing.push("Offer Letter");
            }
            
            if (emp.contractSigned === false) {
                missing.push("Contract");
            }
            
            if (emp.tipCenter === false) {
                missing.push("Tip Center");
            }
            
            // Check for resignation
            if (emp.passportNumber && emp.passportNumber.includes("ÿßÿ≥ÿ™ŸÇÿßŸÑÿ©")) {
                missing.push("RESIGNED");
            }
            
            return missing;
        }

        function updateUI() {
            console.log("Updating UI...");
            renderBranches();
            renderTable(employees);
            updateStats();
            updateMissingDocsSection();
            
            // Update import button
            const importBtn = document.getElementById('importBtn');
            if (allDataImported) {
                importBtn.style.display = 'none';
                document.querySelector('.btn-quick-add').style.display = 'none';
            }
            
            console.log("UI update complete");
        }

        function updateStats() {
            const total = employees.length;
            let ready = 0;
            let warning = 0;
            let expired = 0;
            let missing = 0;
            let resigned = 0;
            
            employees.forEach(emp => {
                const status = getEmployeeStatus(emp);
                switch(status.severity) {
                    case "ready": ready++; break;
                    case "warning": warning++; break;
                    case "expired": expired++; break;
                    case "missing": missing++; break;
                    case "resigned": resigned++; break;
                }
            });
            
            document.getElementById('totalCount').innerText = total;
            document.getElementById('activeCount').innerText = ready;
            document.getElementById('warningCount').innerText = warning;
            document.getElementById('expiredCount').innerText = expired;
            document.getElementById('missingCount').innerText = missing;
            
            console.log(`Stats updated: Total=${total}, Ready=${ready}, Warning=${warning}, Expired=${expired}, Missing=${missing}, Resigned=${resigned}`);
        }

        function updateMissingDocsSection() {
            let missingPassport = 0;
            let missingVisaExpiry = 0;
            let missingPassportExpiry = 0;
            let missingCV = 0;
            let missingPhotos = 0;
            let missingContract = 0;
            let resignedCount = 0;
            
            employees.forEach(emp => {
                if (!emp.passportNumber || emp.passportNumber === "") missingPassport++;
                if (!emp.idVisaExpiry || emp.idVisaExpiry === "") missingVisaExpiry++;
                if (!emp.passportExpiry || emp.passportExpiry === "") missingPassportExpiry++;
                if (emp.cv === false) missingCV++;
                if (emp.photos < 5) missingPhotos++;
                if (emp.contractSigned === false) missingContract++;
                
                // Check for resignation
                if (emp.passportNumber && emp.passportNumber.includes("ÿßÿ≥ÿ™ŸÇÿßŸÑÿ©")) {
                    resignedCount++;
                }
            });
            
            const totalMissing = missingPassport + missingVisaExpiry + missingPassportExpiry + 
                                missingCV + missingPhotos + missingContract;
            
            if (totalMissing > 0 || resignedCount > 0) {
                document.getElementById('missingDocsSection').style.display = 'block';
                document.getElementById('missingTotalCount').innerText = totalMissing + resignedCount;
                
                const categories = [
                    { name: "Passport", count: missingPassport },
                    { name: "Visa Expiry", count: missingVisaExpiry },
                    { name: "Passport Expiry", count: missingPassportExpiry },
                    { name: "CV", count: missingCV },
                    { name: "Photos", count: missingPhotos },
                    { name: "Contract", count: missingContract },
                    { name: "Resigned", count: resignedCount }
                ];
                
                let html = '';
                categories.forEach(cat => {
                    if (cat.count > 0) {
                        html += `
                            <div class="missing-category">
                                <div class="missing-category-name">${cat.name}</div>
                                <div class="missing-category-count">${cat.count}</div>
                            </div>
                        `;
                    }
                });
                
                document.getElementById('missingCategories').innerHTML = html;
            } else {
                document.getElementById('missingDocsSection').style.display = 'none';
            }
        }

        function renderBranches() {
            console.log("Rendering branches...");
            
            const select = document.getElementById('inpBranch');
            const branchFilter = document.getElementById('branchFilter');
            const nationalityFilter = document.getElementById('nationalityFilter');
            const quickBranch = document.getElementById('quickBranch');
            
            // Get unique nationalities from employees
            const nationalities = [...new Set(employees.map(e => e.nationality).filter(n => n))];
            
            select.innerHTML = '<option value="">-- Select Branch --</option>';
            branchFilter.innerHTML = '<option value="">All Branches</option>';
            nationalityFilter.innerHTML = '<option value="">All Nationalities</option>';
            quickBranch.innerHTML = '<option value="">-- Select Branch --</option>';
            
            branches.sort().forEach(b => { 
                select.innerHTML += `<option value="${b}">${b}</option>`;
                branchFilter.innerHTML += `<option value="${b}">${b}</option>`;
                quickBranch.innerHTML += `<option value="${b}">${b}</option>`;
            });
            
            nationalities.sort().forEach(n => {
                nationalityFilter.innerHTML += `<option value="${n}">${n}</option>`;
            });

            const list = document.getElementById('branchListDisplay');
            list.innerHTML = '';
            
            if (branches.length === 0) {
                list.innerHTML = '<li style="text-align: center; color: #999;">No branches added yet</li>';
            } else {
                branches.sort().forEach(b => {
                    const staffCount = employees.filter(e => e.branch === b).length;
                    list.innerHTML += `
                        <li>
                            <div>
                                <strong>${b}</strong>
                                <div style="font-size: 11px; color: #666; margin-top: 3px;">${staffCount} staff</div>
                            </div>
                            <button class="action-btn btn-del" onclick="deleteBranch('${b}')" title="Delete branch">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                    `;
                });
            }
            
            console.log(`Branches rendered: ${branches.length}, Nationalities: ${nationalities.length}`);
        }

        function renderTable(data) {
            console.log(`Rendering table with ${data.length} employees...`);
            
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="14" style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;">üë®‚Äçüç≥</div>
                            <h3>No Staff Records Found</h3>
                            <p>Click "Import All Data" to load complete employee database or "Add Staff" to add new records.</p>
                            <button class="btn-add" onclick="importAllData()" style="margin-top: 15px;">
                                üì• Import Complete Database
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }

            data.forEach(emp => {
                const status = getEmployeeStatus(emp);
                const missingItems = getMissingItems(emp);
                
                const passExpStatus = getExpiryStatus(emp.passportExpiry);
                const idExpStatus = getExpiryStatus(emp.idVisaExpiry);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${emp.id}</strong></td>
                    <td>${emp.name}</td>
                    <td>${emp.nationality || '-'}</td>
                    <td>${emp.gender || '-'}</td>
                    <td>${emp.designation || '-'}</td>
                    <td>${emp.joiningDate || '-'}</td>
                    <td>${emp.idNumber || '-'}</td>
                    <td>${emp.passportNumber || '-'}</td>
                    <td>${emp.passportExpiry ? `<span class="${passExpStatus.class}">${passExpStatus.text}</span><br><small style="color:#aaa">${emp.passportExpiry}</small>` : '-'}</td>
                    <td>${emp.idVisaExpiry ? `<span class="${idExpStatus.class}">${idExpStatus.text}</span><br><small style="color:#aaa">${emp.idVisaExpiry}</small>` : '-'}</td>
                    <td>${emp.branch || '-'}</td>
                    <td><span class="badge ${status.class}">${status.label}</span></td>
                    <td>
                        ${missingItems.length > 0 ? 
                            `<small style="color: #dc3545; font-weight: 600;">${missingItems.join(', ')}</small>` : 
                            '<span class="check-yes">‚úÖ</span>'
                        }
                    </td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editEmployee('${emp.id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn btn-del" onclick="deleteEmployee('${emp.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            console.log(`Table rendered with ${data.length} rows`);
        }

        // --- FILTERING ---
        function filterData() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const branchFilter = document.getElementById('branchFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const nationalityFilter = document.getElementById('nationalityFilter').value;
            
            console.log(`Filtering: query="${query}", branch="${branchFilter}", status="${statusFilter}", nationality="${nationalityFilter}"`);
            
            const filtered = employees.filter(emp => {
                // Search query
                const matchesSearch = !query || 
                    (emp.id && emp.id.toLowerCase().includes(query)) || 
                    (emp.name && emp.name.toLowerCase().includes(query)) || 
                    (emp.nationality && emp.nationality.toLowerCase().includes(query)) ||
                    (emp.designation && emp.designation.toLowerCase().includes(query)) ||
                    (emp.passportNumber && emp.passportNumber.toLowerCase().includes(query));
                
                // Branch filter
                const matchesBranch = !branchFilter || emp.branch === branchFilter;
                
                // Status filter
                const status = getEmployeeStatus(emp);
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'ready' && status.severity === 'ready') || 
                    (statusFilter === 'warning' && status.severity === 'warning') || 
                    (statusFilter === 'expired' && status.severity === 'expired') ||
                    (statusFilter === 'missing' && status.severity === 'missing');
                
                // Nationality filter
                const matchesNationality = !nationalityFilter || emp.nationality === nationalityFilter;
                
                return matchesSearch && matchesBranch && matchesStatus && matchesNationality;
            });
            
            console.log(`Filtered to ${filtered.length} employees`);
            renderTable(filtered);
        }

        // --- BRANCH ACTIONS ---
        function openBranchModal() {
            renderBranches();
            openModal('branchModal');
        }

        function addNewBranch() {
            const input = document.getElementById('newBranchName');
            const name = input.value.trim();
            
            if (!name) {
                showToast("Please enter a branch name", "warning");
                return;
            }
            
            if (branches.includes(name)) {
                showToast("Branch already exists", "warning");
                return;
            }
            
            branches.push(name);
            saveData();
            renderBranches();
            input.value = '';
            showToast("Branch added successfully", "success");
        }
        
        function deleteBranch(name) {
            if (confirm(`Delete branch "${name}"?`)) {
                const staffInBranch = employees.filter(emp => emp.branch === name);
                if (staffInBranch.length > 0) {
                    showToast(`Cannot delete: ${staffInBranch.length} staff assigned to this branch`, "error");
                    return;
                }
                
                branches = branches.filter(b => b !== name);
                saveData();
                renderBranches();
                showToast("Branch deleted successfully", "success");
            }
        }

        // --- STAFF MODAL ACTIONS ---
        function openAddModal() {
            document.getElementById('modalTitle').innerText = "Add New Staff Member";
            document.getElementById('editId').value = "";
            document.getElementById('staffForm').reset();
            
            // Set default dates
            const today = new Date();
            const nextYear = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
            document.getElementById('inpPassExp').value = formatDate(nextYear);
            document.getElementById('inpIdVisaExp').value = formatDate(nextYear);
            document.getElementById('inpMedicalExp').value = formatDate(nextYear);
            document.getElementById('inpJoiningDate').value = formatDate(today);
            
            openModal('staffModal');
        }
        
        function openQuickAddModal() {
            renderBranches();
            openModal('quickAddModal');
        }
        
        function saveQuickStaff() {
            const id = document.getElementById('quickId').value.trim();
            const name = document.getElementById('quickName').value.trim();
            const branch = document.getElementById('quickBranch').value;
            
            if (!id || !name || !branch) {
                showToast("Please fill all required fields", "error");
                return;
            }
            
            if (employees.some(e => e.id === id)) {
                showToast("Employee ID already exists", "error");
                return;
            }
            
            const newStaff = {
                id: id,
                name: name,
                nationality: document.getElementById('quickNationality').value,
                designation: document.getElementById('quickDesignation').value,
                branch: branch,
                joiningDate: formatDate(new Date()),
                passportNumber: "",
                passportExpiry: "",
                idVisaExpiry: "",
                cv: true,
                photos: 5,
                passportReceived: false,
                tipCenter: true,
                offerLetter: true,
                contractSigned: true,
                medicalExpiry: "",
                insurance: "valid",
                notes: ""
            };
            
            employees.unshift(newStaff);
            saveData();
            filterData();
            closeModal('quickAddModal');
            showToast("Staff added successfully", "success");
        }

        function editEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if(!emp) return;

            document.getElementById('modalTitle').innerText = `Edit Staff: ${emp.name}`;
            document.getElementById('editId').value = emp.id;

            // Fill all fields
            document.getElementById('inpId').value = emp.id;
            document.getElementById('inpName').value = emp.name;
            document.getElementById('inpNationality').value = emp.nationality || "";
            document.getElementById('inpGender').value = emp.gender || "Male";
            document.getElementById('inpDesignation').value = emp.designation || "";
            document.getElementById('inpBranch').value = emp.branch || "";
            document.getElementById('inpJoiningDate').value = emp.joiningDate || "";
            document.getElementById('inpIdNumber').value = emp.idNumber || "";
            document.getElementById('inpPassNum').value = emp.passportNumber || "";
            document.getElementById('inpPassExp').value = emp.passportExpiry || "";
            document.getElementById('inpIdVisaExp').value = emp.idVisaExpiry || "";
            document.getElementById('inpMedicalExp').value = emp.medicalExpiry || "";
            document.getElementById('inpNotes').value = emp.notes || "";
            document.getElementById('inpPhotos').value = emp.photos || 0;
            
            // Checklist items
            document.getElementById('inpCV').value = emp.cv ? "true" : "false";
            document.getElementById('inpPassportReceived').value = emp.passportReceived ? "true" : "false";
            document.getElementById('inpTipCenter').value = emp.tipCenter ? "true" : "false";
            document.getElementById('inpOffer').value = emp.offerLetter ? "true" : "false";
            document.getElementById('inpContract').value = emp.contractSigned ? "true" : "false";
            document.getElementById('inpInsurance').value = emp.insurance || "valid";

            openModal('staffModal');
        }

        function saveStaff() {
            const editId = document.getElementById('editId').value;
            const id = document.getElementById('inpId').value.trim();
            const name = document.getElementById('inpName').value.trim();
            const branch = document.getElementById('inpBranch').value;
            
            if (!id || !name || !branch) {
                showToast("Please fill all required fields", "error");
                return;
            }

            const formData = {
                id: id, 
                name: name,
                nationality: document.getElementById('inpNationality').value,
                gender: document.getElementById('inpGender').value,
                designation: document.getElementById('inpDesignation').value,
                branch: branch,
                joiningDate: document.getElementById('inpJoiningDate').value,
                idNumber: document.getElementById('inpIdNumber').value,
                passportNumber: document.getElementById('inpPassNum').value,
                passportExpiry: document.getElementById('inpPassExp').value,
                idVisaExpiry: document.getElementById('inpIdVisaExp').value,
                notes: document.getElementById('inpNotes').value,
                
                // Checklist items
                cv: document.getElementById('inpCV').value === 'true',
                photos: parseInt(document.getElementById('inpPhotos').value) || 0,
                passportReceived: document.getElementById('inpPassportReceived').value === 'true',
                tipCenter: document.getElementById('inpTipCenter').value === 'true',
                offerLetter: document.getElementById('inpOffer').value === 'true',
                contractSigned: document.getElementById('inpContract').value === 'true',
                medicalExpiry: document.getElementById('inpMedicalExp').value,
                insurance: document.getElementById('inpInsurance').value
            };

            if (editId) {
                const index = employees.findIndex(e => e.id === editId);
                if (index !== -1) { 
                    employees[index] = formData; 
                    showToast("Staff updated successfully", "success"); 
                }
            } else {
                if (employees.some(e => e.id === id)) { 
                    showToast("Employee ID already exists", "error"); 
                    return; 
                }
                employees.unshift(formData);
                showToast("Staff added successfully", "success");
            }

            saveData();
            filterData();
            closeModal('staffModal');
        }

        function deleteEmployee(id) {
            if(confirm("Delete this employee record? This action cannot be undone.")) {
                employees = employees.filter(e => e.id !== id);
                saveData();
                filterData();
                showToast("Record deleted", "success");
            }
        }

        // --- UTILITIES ---
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function openModal(id) { 
            document.getElementById(id).classList.add('open'); 
        }
        
        function closeModal(id) { 
            document.getElementById(id).classList.remove('open'); 
        }
        
        function showToast(msg, type = "success") {
            const x = document.getElementById("toast"); 
            x.innerText = msg; 
            x.className = `toast show ${type}`;
            
            setTimeout(() => { 
                x.className = x.className.replace("show", ""); 
            }, 3000);
        }

        function getExpiryStatus(dateStr) {
            if (!dateStr) return { text: '-', class: '' };

            const today = new Date();
            today.setHours(0,0,0,0);
            
            const target = new Date(dateStr);
            const diffTime = target - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays <= 0) {
                return { text: `EXPIRED`, class: 'date-expired' };
            }
            if (diffDays <= 30) {
                return { text: `${diffDays} days`, class: 'date-warning' };
            }
            return { text: `${diffDays} days`, class: 'date-safe' }; 
        }

        function toggleColumnVisibility() {
            alert("Column visibility toggle - This feature would allow you to show/hide specific columns in the table.");
        }
        
        function sortByExpiry() {
            // Sort employees by earliest expiry date
            employees.sort((a, b) => {
                const aDate = a.passportExpiry || a.idVisaExpiry || '9999-12-31';
                const bDate = b.passportExpiry || b.idVisaExpiry || '9999-12-31';
                return new Date(aDate) - new Date(bDate);
            });
            
            saveData();
            filterData();
            showToast("Sorted by earliest expiry date", "success");
        }
        
        function showHelp() {
            alert(`CRISPY CHICKEN HR SYSTEM - COMPLETE VERSION

üìä COMPLETE DATA IMPORT:
‚Ä¢ Click "üì• Import All Data" to load all employees
‚Ä¢ Complete employee database from Excel
‚Ä¢ All fields: Names, Nationality, Designation, Passport details, etc.

‚ö†Ô∏è MISSING DOCUMENTS HEADLINE:
‚Ä¢ Shows total missing documents across all staff
‚Ä¢ Breaks down by category: Passport, Visa Expiry, CV, etc.
‚Ä¢ Helps identify compliance gaps quickly

üè¢ BRANCH MANAGEMENT:
‚Ä¢ View staff distribution across branches
‚Ä¢ Add/remove branches as needed
‚Ä¢ Branch-specific filtering

üìã STATUS INDICATORS:
‚Ä¢ üü¢ Working Fine - All documents valid
‚Ä¢ üü° Expiring Soon - Documents expiring within 30 days
‚Ä¢ üî¥ Expired - Documents already expired
‚Ä¢ üî¥ Missing Docs - Essential documents missing
‚Ä¢ üî¥ Resigned - Staff with resignation notes

‚ö° QUICK ACTIONS:
‚Ä¢ Quick Add for fast staff entry
‚Ä¢ Bulk import of complete data
‚Ä¢ Email reports to management
‚Ä¢ Excel export for offline analysis

üí° TIPS:
‚Ä¢ Most staff are working fine with no issues
‚Ä¢ Focus on "Missing Docs" and "Expiring Soon" sections
‚Ä¢ Use filters to focus on specific branches or nationalities`);
        }
        
        function showSummary() {
            const total = employees.length;
            const ready = employees.filter(e => getEmployeeStatus(e).severity === 'ready').length;
            const percentage = total > 0 ? Math.round((ready / total) * 100) : 0;
            
            alert(`HR SYSTEM SUMMARY:
            
Total Staff: ${total}
Working Fine: ${ready} (${percentage}%)
Expiring Soon: ${employees.filter(e => getEmployeeStatus(e).severity === 'warning').length}
Expired Docs: ${employees.filter(e => getEmployeeStatus(e).severity === 'expired').length}
Missing Docs: ${employees.filter(e => getEmployeeStatus(e).severity === 'missing').length}
Resigned: ${employees.filter(e => getEmployeeStatus(e).severity === 'resigned').length}

STATUS: ${percentage >= 90 ? '‚úÖ EXCELLENT' : percentage >= 80 ? '‚ö†Ô∏è GOOD' : '‚ùå NEEDS ATTENTION'}
Most staff are working with no issues.

Next Actions:
1. Review "Missing Docs" section
2. Check "Expiring Soon" alerts
3. Update any missing information
4. Regular monthly checks recommended`);
        }

        function sendReportEmail() {
            const total = employees.length;
            const ready = employees.filter(e => getEmployeeStatus(e).severity === 'ready').length;
            const warning = employees.filter(e => getEmployeeStatus(e).severity === 'warning').length;
            const expired = employees.filter(e => getEmployeeStatus(e).severity === 'expired').length;
            const missing = employees.filter(e => getEmployeeStatus(e).severity === 'missing').length;
            const resigned = employees.filter(e => getEmployeeStatus(e).severity === 'resigned').length;
            
            const body = `CRISPY CHICKEN HR REPORT - ${new Date().toLocaleDateString()}

SUMMARY:
Total Staff: ${total}
Working Fine: ${ready}
Expiring Soon: ${warning}
Expired Documents: ${expired}
Missing Documents: ${missing}
Resigned Staff: ${resigned}

STATUS: ${ready >= total * 0.9 ? 'EXCELLENT - Most staff working with no issues' : 'REQUIRES ATTENTION - Some issues need resolution'}

MISSING DOCUMENTS SUMMARY:
- Check the HR system for detailed breakdown
- Focus on documents marked as missing or expired

RECOMMENDATIONS:
1. Renew documents expiring within 30 days
2. Collect missing passport copies
3. Update visa expiry dates
4. Regular monthly compliance check

For detailed breakdown, please check the HR system.`;
            
            window.location.href = `mailto:mohammed.t@crispychicken.rest,kenawe@crispychicken.rest?subject=HR Report - ${new Date().toLocaleDateString()}&body=${encodeURIComponent(body)}`;
            showToast("Email client opened with report", "success");
        }

        function exportToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "ID,Name,Nationality,Gender,Designation,Joining Date,ID Number,Passport Number,Passport Expiry,ID/Visa Expiry,Branch,Status,Missing Items\n";
            employees.forEach(e => {
                const status = getEmployeeStatus(e).label;
                const missingItems = getMissingItems(e).join('; ');
                const row = [
                    e.id, e.name, e.nationality || '', e.gender || '', e.designation || '',
                    e.joiningDate || '', e.idNumber || '', e.passportNumber || '',
                    e.passportExpiry || '', e.idVisaExpiry || '', e.branch || '', status, missingItems
                ].map(field => `"${field}"`).join(",");
                csvContent += row + "\n";
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a"); 
            link.setAttribute("href", encodedUri); 
            link.setAttribute("download", `HR_Complete_Report_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link); 
            link.click(); 
            document.body.removeChild(link);
            showToast("Complete report downloaded", "success");
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('open');
            }
        }
    </script>
</body>
</html>
